# Implementation Plan: Global Timer Sync & Storage

## 1. Update Data Interfaces
- **File**: `apps/inngest/src/lib/clockwork-report.ts`
- **Action**: Update `RawTimer` interface to include the `author` field.
  ```typescript
  author?: {
    accountId: string;
    displayName: string;
    emailAddress?: string;
    avatarUrl?: string;
  };
  ```
- **File**: `apps/inngest/src/lib/redis.ts`
- **Action**: Update `CachedTimerEntry` to include `author` information.

## 2. Refactor Inngest Sync Function
- **File**: `apps/inngest/src/inngest/sync-active-timers.ts`
- **Logic**:
  1.  **Fetch**: Execute `fetchActiveTimers` once to get all active timers (using the service account/admin token).
  2.  **Group**: Group the timers by `author.emailAddress`.
  3.  **Cache Per User**: Save each user's timers to Redis key `clockwork:timers:<email>`.
  4.  **Cache All**: Save all timers to Redis key `clockwork:timers:all`.

## 3. Update API Endpoint
- **File**: `apps/api/api/timers/active.ts`
- **Logic**:
  - Check `req.query.userEmail`.
  - If provided: Return data from `clockwork:timers:<email>`.
  - If missing: Return data from `clockwork:timers:all`.

## 4. Shared Library Updates
- **File**: `apps/api/lib/redis.ts`
- **Action**: Sync `CachedTimerEntry` definition changes from Inngest to API (or ensure they share the definition if possible, otherwise update both).

## 5. Verification
- Run `pnpm type-check` to ensure interface consistency.
- Run `pnpm lint` and `pnpm format`.
