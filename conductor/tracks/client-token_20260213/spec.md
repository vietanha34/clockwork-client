# Specification: Client-Side Clockwork API Token

**Track ID:** client-token_20260213
**Type:** Feature
**Created:** 2026-02-13
**Status:** Draft

## Summary

Store the Clockwork API token in Tauri client settings and send it to the server per-request via `X-Clockwork-Token` header, so the server doesn't need a hardcoded personal token. This fixes the start timer flow and enables per-user token support.

## Context

The Clockwork Menubar app proxies timer operations through a Vercel API backend. Currently, the `CLOCKWORK_API_TOKEN` (a personal Clockwork Pro API token) is stored as a server-side environment variable. This is architecturally wrong â€” personal credentials shouldn't live on shared infrastructure. The token should originate from the client.

## User Story

As a Clockwork Pro user, I want to store my personal Clockwork API token in the desktop app so that I can start timers without the server needing my credentials hardcoded.

## Acceptance Criteria

- [ ] Tauri settings UI has a "Clockwork API Token" input field
- [ ] Token is persisted locally in the app settings file
- [ ] Start timer requests include the token via `X-Clockwork-Token` header
- [ ] API route extracts the header and passes the token to clockwork-client
- [ ] Server falls back to `CLOCKWORK_API_TOKEN` env var if no header is provided
- [ ] Start timer works end-to-end using the client-provided token

## Dependencies

- Existing `clockwork-client.ts` (`clockworkFetch` and `startTimer`)
- Tauri settings system (`lib.rs`, `types.ts`, `SettingsView.tsx`, `settings-context.tsx`)
- API route `/api/timers/start`

## Out of Scope

- Token encryption/obfuscation in local storage
- Migrating the stop timer flow (uses JWT from Jira cookie)
- Migrating `getWorklogs` to use client token (follow-up track)
- Multi-user support / user management
- Token validation UI

## Technical Notes

- **Approach B (Header-based):** Token sent via `X-Clockwork-Token` HTTP header
- Server extracts header and passes token through to `clockworkFetch`
- Fallback to `CLOCKWORK_API_TOKEN` env var for backward compatibility
- Token stored in plain text in Tauri settings file (acceptable for desktop app)

---

_Generated by Conductor. Review and edit as needed._
