# Implementation Plan: Windows Platform Support

**Track ID:** windows-platform-support_20260225
**Spec:** [spec.md](./spec.md)
**Created:** 2026-02-25
**Status:** [x] Implemented

## Overview

Add Windows platform support through 3 phases: foundation (dependencies + platform detection), core logic (window positioning + tray tooltip), and visual polish (CSS overrides). All changes use platform branching — no changes to macOS/Linux behavior.

## Phase 1: Foundation

Set up platform detection infrastructure and extract constants.

### Tasks

- [x] Task 1.1: Add `@tauri-apps/plugin-os` dependency to `apps/tauri/package.json` and configure the Tauri OS plugin in `apps/tauri/src-tauri/Cargo.toml` and `tauri.conf.json` if needed
- [x] Task 1.2: Add platform detection in `App.tsx` — detect OS on mount, add `platform-windows` CSS class to `document.documentElement` when on Windows
- [x] Task 1.3: Extract `WINDOW_WIDTH` (302) and `WINDOW_HEIGHT` (540) as constants in `lib.rs`, replace hardcoded values in existing positioning math

### Verification

- [ ] App compiles and runs on macOS with no behavior change
- [ ] `platform()` call works and returns correct value
- [ ] Constants are used in positioning calculation (no hardcoded 302 in math)

## Phase 2: Core Platform Logic

Implement Windows-specific window positioning and tray tooltip.

### Tasks

- [x] Task 2.1: Branch window positioning in tray click handler (`lib.rs`) — use `#[cfg(target_os = "windows")]` to position window above tray icon: `y = tray_y - WINDOW_HEIGHT - 1`
- [x] Task 2.2: Add `update_tray_tooltip` Tauri command in `lib.rs` — accepts text string, calls `tray.set_tooltip()`. Register command in builder invoke handler
- [x] Task 2.3: Modify `useTrayTimer.ts` to detect platform and branch: on Windows call `update_tray_tooltip` with format `"ISSUE-KEY: HH:MM:SS"`, on macOS/Linux keep existing canvas bitmap logic

### Verification

- [ ] On macOS: popover appears below tray icon (unchanged)
- [ ] On Windows: popover appears above tray icon
- [ ] On Windows: tray tooltip updates every second with timer info
- [ ] On macOS: tray bitmap still updates as before

## Phase 3: Visual Polish

Apply Windows-native popover styling.

### Tasks

- [x] Task 3.1: Add `.platform-windows .menubar-popover` CSS overrides in `index.css` — set `border-radius: 8px`, hide `::before` and `::after` pseudo-elements (arrow), adjust box-shadow to Windows notification style
- [x] Task 3.2: Verify popover padding/spacing still works without the arrow — adjust top/bottom padding if needed since arrow space is no longer needed on Windows

### Verification

- [ ] On macOS: popover has 20px radius and arrow (unchanged)
- [ ] On Windows: popover has 8px radius, no arrow, appropriate shadow
- [ ] No layout overflow or clipping issues on either platform

## Final Verification

- [ ] All acceptance criteria met
- [ ] macOS behavior completely unchanged
- [ ] App compiles for both macOS and Windows targets
- [ ] Manual testing on Windows confirms correct positioning, tooltip, and style

---

_Generated by Conductor. Tasks will be marked [~] in progress and [x] complete._
