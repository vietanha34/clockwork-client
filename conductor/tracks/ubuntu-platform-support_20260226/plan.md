# Implementation Plan: Ubuntu Platform Support

**Track ID:** ubuntu-platform-support_20260226
**Spec:** [spec.md](./spec.md)
**Created:** 2026-02-26
**Status:** [~] In Progress

## Overview

Refactor platform detection into a `macos` vs `desktop` group abstraction, replace all Windows-specific checks with the helper, rename CSS classes, fix Rust window positioning for Linux, and add a tray context menu for Linux.

## Phase 1: Platform Helper & Frontend Refactor

Create the platform abstraction and migrate all frontend files.

### Tasks

- [x] Task 1.1: Create `apps/tauri/src/lib/platform.ts` with `getPlatformGroup()` and `isSquareTrayPlatform()` helpers
- [x] Task 1.2: Refactor `apps/tauri/src/App.tsx` — replace `platform()` import with `isSquareTrayPlatform()`, change CSS class to `platform-desktop`
- [x] Task 1.3: Refactor `apps/tauri/src/hooks/useTrayTimer.ts` — replace all `os === 'windows'` checks with `isSquareTrayPlatform()`
- [x] Task 1.4: Refactor `apps/tauri/src/views/MainView.tsx` — replace `platform()` with `isSquareTrayPlatform()` for daily progress bar
- [x] Task 1.5: Refactor `apps/tauri/src/views/SettingsView.tsx` — use `isSquareTrayPlatform()` for pin guide visibility, add Linux-specific guide text
- [x] Task 1.6: Rename `.platform-windows` to `.platform-desktop` in `apps/tauri/src/index.css`

### Verification

- [x] `npx tsc --noEmit` passes in `apps/tauri`
- [x] `npx biome check src/` passes in `apps/tauri`
- [x] No remaining `os === 'windows'` in frontend code (except SettingsView OS-specific text)

## Phase 2: Rust Backend Changes

Fix window positioning and add tray context menu for Linux.

### Tasks

- [x] Task 2.1: Update window positioning in `apps/tauri/src-tauri/src/lib.rs` — group Linux with Windows (`#[cfg(any(target_os = "windows", target_os = "linux"))]`)
- [x] Task 2.2: Add Linux tray context menu with "Show/Hide" and "Quit" items using `MenuBuilder`, set `show_menu_on_left_click(true)`

### Verification

- [x] `cargo check` succeeds in `apps/tauri/src-tauri`
- [x] No compilation warnings (warnings chỉ về unused imports khi build trên non-Linux)

## Phase 3: Final Verification

### Tasks

- [ ] Task 3.1: Run full TypeScript type check and lint
- [ ] Task 3.2: Manual verification on macOS (no regressions)

### Verification

- [ ] All acceptance criteria from spec.md met
- [ ] macOS behavior unchanged
- [ ] Ready for review

## Final Verification

- [ ] All acceptance criteria met
- [ ] Tests passing
- [ ] Documentation updated (if applicable)
- [ ] Ready for review

---

_Generated by Conductor. Tasks will be marked [~] in progress and [x] complete._
