# Implementation Plan: Timer "On Hold" Status

**Track ID:** timer-onhold-status_20260226
**Spec:** [spec.md](./spec.md)
**Created:** 2026-02-26
**Status:** [~] In Progress

## Overview

Map `within_working_hours` through the API layer, create a timer status utility, update the ActiveTimer UI with amber "On Hold" styling, add a third tray icon state, and update the tray rendering for all platforms.

**Depends on:** ubuntu-platform-support_20260226 (for `isSquareTrayPlatform()` helper)

## Phase 1: API Layer — Map withinWorkingHours

Add the missing fields to the Timer interface and map them from the raw API response.

### Tasks

- [x] Task 1.1: Add `withinWorkingHours` and `startedWithinWorkingHours` to `Timer` interface in `apps/api/src/lib/types.ts`
- [x] Task 1.2: Map fields in `apps/api/src/lib/jira-user-resolver.ts` (default `null` to `true`)
- [x] Task 1.3: Add same fields to Tauri `Timer` interface in `apps/tauri/src/lib/types.ts`

### Verification

- [x] `npx tsc --noEmit` passes in both `apps/api` and `apps/tauri`

## Phase 2: Timer Status Utility & UI

Create the status derivation logic and update ActiveTimer component.

### Tasks

- [x] Task 2.1: Create `apps/tauri/src/lib/timer-utils.ts` with `getTimerStatus()` returning `'running' | 'on_hold' | 'stopped'`
- [x] Task 2.2: Update `apps/tauri/src/components/ActiveTimer.tsx` — derive status, add amber card styling, pause icon, and "On Hold" badge

### Verification

- [x] TypeScript compiles without errors
- [x] ActiveTimer renders correctly for both running and on-hold states

## Phase 3: Tray Icon — 3 States

Add amber tray icon, update Rust command, and update frontend tray hook.

### Tasks

- [x] Task 3.1: Create `apps/tauri/src-tauri/icons/tray-onhold.png` (amber 32x32)
- [x] Task 3.2: Update `update_tray_icon_state` in `apps/tauri/src-tauri/src/lib.rs` to accept `state: String` with 3 values
- [x] Task 3.3: Update `apps/tauri/src/hooks/useTrayTimer.ts` — add `withinWorkingHours` param, update square tray state logic, update macOS canvas colors to amber when on hold
- [x] Task 3.4: Pass `withinWorkingHours` from `apps/tauri/src/App.tsx` to `useTrayTimer` hook

### Verification

- [x] `cargo check` succeeds
- [x] TypeScript compiles without errors
- [x] Tray icon changes state correctly for idle/active/onhold

## Phase 4: Final Verification

### Tasks

- [ ] Task 4.1: Run full TypeScript type check and lint across both apps
- [ ] Task 4.2: Manual verification of all 3 timer states

### Verification

- [ ] All acceptance criteria from spec.md met
- [ ] Tests passing
- [ ] Ready for review

## Final Verification

- [ ] All acceptance criteria met
- [ ] Tests passing
- [ ] Documentation updated (if applicable)
- [ ] Ready for review

---

_Generated by Conductor. Tasks will be marked [~] in progress and [x] complete._
