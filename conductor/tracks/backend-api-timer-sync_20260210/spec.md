# Specification: Backend API & Inngest Timer Sync

**Track ID:** backend-api-timer-sync_20260210
**Type:** Feature
**Created:** 2026-02-10
**Status:** Draft

## Summary

Implement all Vercel API proxy routes (worklogs, timer start/stop, issue/project info via Atlassian) and the Inngest `sync-active-timers` function with JWT acquisition and Upstash Redis caching.

## Context

The Clockwork Menubar backend proxy is the bridge between the Tauri desktop client and external services (Clockwork Pro API, Atlassian/Jira API). Active timer data is fetched via a 2-step crawl: exchange a Jira session cookie for a Clockwork JWT, then query `timers.json` from the Clockwork Report API. Results are cached in Upstash Redis. Worklogs and timer controls use the standard Clockwork Pro REST API.

## User Story

As a Jira user with Clockwork Pro, I want a backend API that fetches my active timers, worklogs, and syncs timer state to Redis so that the desktop client can display real-time data without direct browser authentication.

## Acceptance Criteria

- [ ] `GET /api/timers/active` returns cached active timer data from Redis
- [ ] `GET /api/worklogs` returns today's worklogs for a user via Clockwork API
- [ ] `POST /api/timers/start` starts a new timer via Clockwork API
- [ ] `POST /api/timers/stop` stops the current timer via Clockwork API
- [ ] `GET /api/issues/:key` returns issue details via Atlassian API
- [ ] Inngest `sync-active-timers` function: acquires JWT, fetches timers, caches in Redis
- [ ] Inngest function can be triggered manually (event-based)

## Dependencies

- `monorepo-scaffolding_20260210` (complete) — `apps/api` and `apps/inngest` scaffolding exists

## Out of Scope

- No Tauri client UI
- No user authentication flow or credential storage
- No deployment to Vercel (local dev only for this track)
- No rate limiting or advanced error handling
- No Inngest cron scheduling (manual trigger only)

## Technical Notes

- Vercel API routes: TypeScript with `@vercel/node` handler pattern
- Redis: `@upstash/redis` with key pattern `clockwork:timers:{userEmail}`
- Clockwork API: `X-Clockwork-Token` header for auth
- Atlassian API: Basic auth (`email:api_token` base64 encoded)
- Inngest: 3-step function (acquire-jwt → fetch-timers → cache-redis)
- All secrets via environment variables

---

_Generated by Conductor. Review and edit as needed._
