# Specification: Jira User Enrichment for Active Timers

**Track ID:** jira-user-enrichment_20260211
**Type:** Feature
**Created:** 2026-02-11
**Status:** Draft

## Summary

Enrich active timer data with full Jira user info (email, display name) by resolving the `running_for` Jira accountId via the Atlassian REST API, caching results in Redis for 2 days to minimise API calls.

## Context

The Clockwork Report API returns timer objects where `running_for` holds a Jira user accountId but does not reliably include `author.emailAddress`. The Inngest `sync-active-timers` function currently falls back to an empty string for missing emails, causing per-user timer grouping (keyed on `clockwork:timers:<email>`) to silently fail for those users.

## Acceptance Criteria

- [ ] A `getJiraUser(accountId)` function fetches user info from Jira REST API (`/rest/api/3/user?accountId=...`) and returns `{ accountId, emailAddress, displayName, avatarUrl }`
- [ ] Jira user lookup results are cached in Redis under `jira:user:<accountId>` with a 2-day TTL (172,800 s)
- [ ] Cache is checked before making any Jira API call; a hit short-circuits the network request
- [ ] The `sync-active-timers` Inngest function uses this lookup to populate `author.emailAddress` and `author.displayName` when missing from the raw Clockwork timer
- [ ] Timer grouping by user email works correctly for all timers that have a resolvable `running_for` accountId
- [ ] If the Jira API call fails, the timer is still cached (with empty email) and the error is logged â€” no crash

## Dependencies

- Existing `atlassian-client.ts` (HTTP helper, auth)
- Existing `redis.ts` (Redis client)
- `ATLASSIAN_EMAIL` + `ATLASSIAN_API_TOKEN` + `JIRA_DOMAIN` env vars (already required)

## Out of Scope

- Updating the Tauri client UI for the new fields (already handles `author.emailAddress`)
- Bulk pre-population of the user cache
- Invalidating the user cache on demand

## Technical Notes

- New function `getJiraUser(accountId)` added to `atlassian-client.ts`
- New get/set helpers added to `redis.ts` for the user cache
- New `jira-user-resolver.ts` module in `apps/api/src/lib/` orchestrates cache-first lookup
- `sync-active-timers.ts` calls `resolveTimerAuthors` helper before grouping/caching timers

---

_Generated by Conductor. Review and edit as needed._
