# Implementation Plan: Jira Issue Search for Start Timer

**Track ID:** issue-search_20260213
**Spec:** [spec.md](./spec.md)
**Created:** 2026-02-13
**Status:** [~] In Progress

## Overview

Add JQL-based issue search to the backend, wire it through the Tauri client, and replace the plain text input in StartTimerForm with a searchable combobox that shows in-progress issues by default and search results on typing.

## Phase 1: Backend — Jira Issue Search API

Add JQL search capability to the atlassian client and expose it via a new API route.

### Tasks

- [x] Task 1.1: Add `searchIssues(jql, maxResults)` function to `apps/api/src/lib/atlassian-client.ts` using Jira `/rest/api/3/search` endpoint
- [x] Task 1.2: Create `GET /api/issues/search` route in `apps/api/api/issues/search.ts` — accepts `q` (search text) and `accountId` params, builds JQL (empty query → user's in-progress issues; text query → all issues matching key or summary), returns `Issue[]`
- [x] Task 1.3: Add `SearchIssuesResponse` type to `apps/api/src/lib/types.ts`

### Verification

- [ ] `GET /api/issues/search?accountId=xxx` returns in-progress issues for the user
- [ ] `GET /api/issues/search?q=KAN&accountId=xxx` returns matching issues across all projects

## Phase 2: Client Plumbing — API Client & Hook

Wire up the Tauri client to call the search endpoint with debouncing.

### Tasks

- [x] Task 2.1: Add `searchIssues(apiBaseUrl, query, accountId)` function to `apps/tauri/src/lib/api-client.ts`
- [x] Task 2.2: Add `Issue` type (if not already present) and `SearchIssuesResponse` to `apps/tauri/src/lib/types.ts`
- [x] Task 2.3: Create `useIssueSearch(query, accountId)` hook in `apps/tauri/src/hooks/useIssueSearch.ts` — React Query with 300ms debounce, 30s stale time, max 10 results

### Verification

- [ ] Hook returns in-progress issues on empty query, search results on text input

## Phase 3: UI — Searchable Combobox in StartTimerForm

Replace the plain text input with a searchable combobox dropdown.

### Tasks

- [x] Task 3.1: Create `IssueCombobox` component in `apps/tauri/src/components/IssueCombobox.tsx` — input field with absolute-positioned dropdown, shows `[KEY] Summary (Status)` per item, loading/empty states
- [x] Task 3.2: Integrate `IssueCombobox` into `StartTimerForm.tsx` — replace plain issue key input, wire selected issue to form state
- [x] Task 3.3: Handle edge cases — allow manual key entry without dropdown selection, close dropdown on blur/escape, keyboard up/down navigation for item selection

### Verification

- [ ] Empty input focus shows user's in-progress issues
- [ ] Typing searches all project issues with debounce
- [ ] Selecting an item fills the issue key and closes dropdown
- [ ] Manual key entry still works without selecting from dropdown

## Final Verification

- [ ] End-to-end: Focus input → see in-progress issues → type to search → select → start timer
- [ ] No regressions in existing start/stop timer functionality
- [ ] Combobox works well in the small Tauri popup window

---

_Generated by Conductor. Tasks will be marked [~] in progress and [x] complete._
