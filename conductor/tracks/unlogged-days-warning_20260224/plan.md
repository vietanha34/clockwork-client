# Implementation Plan: Unlogged Days Warning

**Track ID:** unlogged-days-warning_20260224
**Spec:** [spec.md](./spec.md)
**Created:** 2026-02-24
**Status:** [~] In Progress

## Overview

Implement a client-side warning system in the Tauri app that detects weekdays with insufficient logged hours and alerts the user via an in-app banner and tray icon indicator. No backend changes needed.

## Phase 1: Data Layer

Create the hook that fetches and computes unlogged days.

### Tasks

- [x] Task 1.1: Create `useUnloggedDays` hook in `apps/tauri/src/hooks/useUnloggedDays.ts` — compute weekdays from Monday to yesterday, use `useQueries` to fetch worklogs for each day, filter days with `total < 28800`
- [x] Task 1.2: Add helper function `getWeekdaysUntilYesterday()` that returns an array of `{ date: string, dayOfWeek: string }` for Mon-Fri from start of current week to yesterday
- [x] Task 1.3: Define `UnloggedDay` type in `apps/tauri/src/lib/types.ts`

### Verification

- [ ] Hook correctly returns unlogged days when test data has days < 8h
- [ ] Hook returns empty array when all days are >= 8h
- [ ] Weekend days are excluded
- [ ] On Monday, no days are checked (no previous weekdays in current week)

## Phase 2: Warning Banner UI

Build the banner component and guide modal, integrate into MainView.

### Tasks

- [ ] Task 2.1: Create `UnloggedDaysWarning` component in `apps/tauri/src/components/UnloggedDaysWarning.tsx` — amber banner listing unlogged days, collapsible, with "Huong dan log bu" button
- [ ] Task 2.2: Create `LogGuideModal` component in `apps/tauri/src/components/LogGuideModal.tsx` — overlay modal with markdown-style instructions for logging time via CLI tools and Clockwork web
- [ ] Task 2.3: Integrate `UnloggedDaysWarning` into `MainView.tsx` — render at top of view, pass `unloggedDays` data from hook

### Verification

- [ ] Banner appears when unlogged days exist
- [ ] Banner is hidden when all days are logged
- [ ] Collapse/expand works correctly
- [ ] Guide modal opens and dismisses properly
- [ ] Banner styling matches app design (amber theme)

## Phase 3: Tray Icon Indicator

Add red dot to tray icon when unlogged days exist.

### Tasks

- [ ] Task 3.1: Modify `App.tsx` to pass `hasUnloggedDays` boolean to `useTrayTimer` hook
- [ ] Task 3.2: Modify `useTrayTimer.ts` to draw a red dot at the top-right corner of the tray icon bitmap when `hasUnloggedDays === true`

### Verification

- [ ] Red dot appears on tray icon when unlogged days exist
- [ ] Red dot disappears when all days are sufficiently logged
- [ ] Existing progress bar and timer text remain unaffected

## Phase 4: Refetch Integration

Wire up re-checking after stop timer actions.

### Tasks

- [ ] Task 4.1: Modify `useTimerActions.ts` — after successful `stopTimer`, invalidate worklog queries for previous days to trigger re-check of unlogged days

### Verification

- [ ] After stopping a timer, unlogged days warning updates if the stopped timer's worklog affects a previous day
- [ ] No unnecessary refetches for today's worklogs (already handled separately)

## Final Verification

- [ ] All acceptance criteria met
- [ ] No regressions in existing timer display, worklog list, or tray icon
- [ ] App works correctly on Monday (no previous weekdays to check)
- [ ] App works correctly on Friday (checks Mon-Thu)
- [ ] Banner + tray icon stay in sync
- [ ] Manual testing of full flow: open app with missing hours → see warning → stop a timer → warning updates

---

_Generated by Conductor. Tasks will be marked [~] in progress and [x] complete._
