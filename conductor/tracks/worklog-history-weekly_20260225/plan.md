# Implementation Plan: Worklog History & Weekly Summary

**Track ID:** worklog-history-weekly_20260225
**Spec:** [spec.md](./spec.md)
**Created:** 2026-02-25
**Status:** [~] In Progress

## Overview

Upgrade the WorklogList area in MainView by adding a tab switcher, date strip, and weekly chart. Work is split into 4 phases: data layer, date strip + tabs UI, chart component, and integration.

## Phase 1: Data Layer

Add the hook for fetching weekly worklog totals and upgrade existing hook for dynamic date support.

### Tasks

- [x] Task 1.1: Create `useWeeklyWorklogs()` hook — uses `useQueries` to fetch worklogs for all 7 days of the current week (Mon→Sun) in parallel. Returns array of `{ date, dayOfWeek, totalSeconds }`. Follow `useUnloggedDays` pattern.
- [x] Task 1.2: Create `getWeekDates()` utility — returns array of 7 `YYYY-MM-DD` strings for current week (Mon→Sun). Extract from or reuse logic in `useUnloggedDays.ts`.
- [x] Task 1.3: Verify `useWorklogs` hook works correctly with arbitrary date param (not just today). Add `enabled` option support if missing.

### Verification

- [ ] `useWeeklyWorklogs()` returns correct data for current week when called in isolation
- [ ] `useWorklogs(date)` works for past dates

## Phase 2: Tab Switcher & Date Strip UI

Build the pill segment control and horizontal date strip components.

### Tasks

- [x] Task 2.1: Create `WorklogTabs` component — pill segment control with "List" and "Summary" options. Manages `activeTab` state (`'list' | 'summary'`). Styled as rounded segment buttons with blue-500 active background.
- [x] Task 2.2: Create `DateStrip` component — renders 7 date chips (Mon→Sun current week). Props: `selectedDate`, `onSelectDate`. Today gets blue-500 ring, selected date gets filled background. Each chip shows day abbreviation + date number.
- [x] Task 2.3: Add shared state management in MainView — `selectedDate` (default: today) and `activeTab` (default: 'list') state. Wire `DateStrip` and `WorklogTabs` to these states.

### Verification

- [ ] Tab switching works visually between List and Summary
- [ ] Date strip highlights today and selected date correctly
- [ ] Selecting a date updates the displayed worklogs in List tab

## Phase 3: Weekly Chart

Build the custom SVG bar chart component.

### Tasks

- [x] Task 3.1: Create `WeeklyChart` component — accepts `weekData: { date, dayOfWeek, totalSeconds }[]`. Renders SVG with 7 vertical bars.
- [x] Task 3.2: Implement bar rendering — bar height proportional to hours (scale: max of logged hours or 8h). Colors: blue-500 (>=8h), amber-500 (<8h), gray-200 (future days). Day labels below ("Mo", "Tu", etc.). Hours text above bars.
- [x] Task 3.3: Add 8h target line — dashed horizontal line at 8h mark with subtle label.
- [x] Task 3.4: Add weekly total footer — "Total: XXh XXm" text below the chart using `formatSeconds()`.

### Verification

- [ ] Chart renders correctly with mock data
- [ ] Bar colors change based on 8h threshold
- [ ] Future days show gray placeholder
- [ ] Total calculation is accurate

## Phase 4: Integration & Polish

Wire everything together in MainView and handle edge cases.

### Tasks

- [x] Task 4.1: Integrate into MainView — replace current WorklogList area with the new tabbed layout: WorklogTabs → DateStrip → (List tab: WorklogList | Summary tab: WeeklyChart).
- [x] Task 4.2: Update WorklogList to accept `date` prop — remove hardcoded today, receive selected date from parent.
- [x] Task 4.3: Handle loading & error states — show skeleton/spinner while weekly data loads. Show error card if fetch fails for a date.
- [x] Task 4.4: Verify layout fits 302x443px — ensure all components stack correctly without overflow. Adjust spacing if needed.

### Verification

- [ ] Full flow works: switch tabs, select dates, view worklogs and chart
- [ ] No layout overflow in 302x443px window
- [ ] Loading states display correctly
- [ ] No regressions: active timer, start form, unlogged warning still work

## Final Verification

- [x] All acceptance criteria met
- [ ] Manual testing across multiple dates and tab switches
- [ ] No regressions in existing features
- [ ] Ready for review

---

_Generated by Conductor. Tasks will be marked [~] in progress and [x] complete._
