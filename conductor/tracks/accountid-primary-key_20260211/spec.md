# Specification: Switch Primary Key from Email to accountId

**Track ID:** accountid-primary-key_20260211
**Type:** Feature
**Created:** 2026-02-11
**Status:** Draft

## Summary

Replace `emailAddress` with Jira `accountId` as the primary key for user identity across Redis cache, API endpoints, Inngest sync, and the Tauri client — eliminating the dependency on Jira Cloud email privacy settings.

## Context

The Clockwork Report API returns `running_for` as a Jira `accountId` (always visible). The current system groups timers and stores Redis cache keys by `emailAddress`, which is hidden for non-self users under Jira Cloud's profile privacy settings. This causes timer grouping to silently fail for all team members except the service account.

Design document: `docs/plans/2026-02-11-accountid-primary-key-design.md`

## Acceptance Criteria

- [ ] Inngest `sync-active-timers` groups timers by `running_for` (accountId) and caches under `clockwork:timers:<accountId>`
- [ ] `GET /api/timers/active?accountId=<accountId>` replaces `?userEmail=<email>`
- [ ] New `GET /api/users/resolve?email=<email>` endpoint resolves email → accountId via Jira user search, cached in Redis for 2 days
- [ ] Tauri `AppSettings` stores `userAccountId`; SettingsView resolves and saves it on save
- [ ] Active timers hook uses `accountId` from settings for all queries
- [ ] If `userAccountId` is empty, app shows a nudge instead of crashing

## Dependencies

- `atlassian-client.ts` (Jira HTTP helper)
- `redis.ts` (Redis client + existing cache helpers)
- Existing Tauri settings persistence (Rust `get_settings`/`save_settings`)

## Out of Scope

- Worklogs endpoint (Clockwork Pro API may require email — verify separately)
- Migrating existing Redis data (TTL-based self-expiry is sufficient)
- Multi-tenant / multi-domain support

## Risk Items

- **Worklogs**: Clockwork Pro API worklog query likely requires email. Keep `?userEmail` for worklog endpoint until verified otherwise.

---

_Generated by Conductor._
